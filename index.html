<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apex Fleet Hub</title>
    <style>
        :root { --primary: #ff4d00; --bg: #000000; --card: #121212; --text: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        header { padding: 15px; text-align: center; border-bottom: 2px solid var(--primary); background: #000; font-weight: bold; font-size: 1.2rem; }
        
        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; -webkit-overflow-scrolling: touch; }
        .view { display: none; }
        .view.active { display: block; }
        
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; border-left: 4px solid var(--primary); }
        h2 { color: var(--primary); margin: 0 0 10px 0; font-size: 1rem; text-transform: uppercase; }
        
        input, select { width: 100%; padding: 12px; background: #1e1e1e; border: 1px solid #333; color: #fff; border-radius: 8px; margin: 8px 0; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-delete { background: #2a2a2a; color: #ff4444; border: 1px solid #444; margin-top: 5px; padding: 6px; font-size: 12px; }

        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #000; padding: 15px 0; border-top: 1px solid #222; justify-content: space-around; }
        .nav-btn { background: none; border: none; color: #555; font-size: 1.5rem; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); transform: scale(1.2); }

        .progress-container { background: #222; height: 12px; border-radius: 6px; margin: 10px 0; overflow: hidden; }
        .progress-bar { background: var(--primary); height: 100%; width: 0%; transition: 1s ease; }

        .entry { background: #1a1a1a; padding: 10px; border-radius: 6px; margin-top: 10px; border: 1px solid #333; font-size: 0.9rem; }
        .bike-visual { font-size: 60px; text-align: center; margin: 20px 0; transition: transform 0.2s; }
    </style>
</head>
<body>

<header id="view-title">MOTORRAD</header>

<main>
    <div id="view-bike" class="view active">
        <div class="card">
            <h2 id="disp-bike-name">Mein Motorrad</h2>
            <div id="weather-info">Wetter l√§dt...</div>
            <p id="ride-hint" style="font-weight:bold; margin-top:5px;"></p>
        </div>

        <div class="card">
            <h2>üìù Logbuch</h2>
            <input type="number" id="log-km-b" placeholder="Distanz (km)">
            <input type="number" id="log-min-b" placeholder="Dauer (Min)">
            <select id="log-fun-b"><option value="üî•">Spa√ü: Absolut!</option><option value="üòê">Spa√ü: Mittel</option></select>
            <button class="btn-primary" onclick="saveLog('bike')">Fahrt speichern</button>
            <div id="list-logs-bike"></div>
        </div>

        <div class="card">
            <h2>üîß Service & Pflege</h2>
            <p>KM-Stand: <span id="val-km-bike">0</span> / 15.000</p>
            <div class="progress-container"><div id="bar-bike" class="progress-bar"></div></div>
            <button class="btn-primary" style="background:#333" onclick="manualKM('bike')">KM-Stand anpassen</button>
            <p style="margin-top:15px; font-size:0.8rem">Letzte W√§sche/Kette: <span id="val-clean-bike">-</span></p>
            <button class="btn-primary" onclick="setClean('bike')">Jetzt gereinigt</button>
        </div>

        <div class="card">
            <h2>‚õΩ Tanken (KI Beleg-Scan)</h2>
            <input type="file" onchange="startAIScan('bike')" style="font-size: 12px;">
            <input type="number" id="tank-val-b" placeholder="Betrag in ‚Ç¨">
            <input type="text" id="tank-loc-b" placeholder="Tankstelle / Ort">
            <button class="btn-primary" onclick="saveTank('bike')">Eintrag speichern</button>
            <div id="list-tank-bike"></div>
        </div>

        <div class="card">
            <h2>üõ°Ô∏è Ausr√ºstungs-Check</h2>
            <div id="checklist-bike">
                <label><input type="checkbox"> Helm (Alter/Zustand)</label><br>
                <label><input type="checkbox"> Kettenspannung & Fett</label><br>
                <label><input type="checkbox"> Reifendruck gepr√ºft</label><br>
                <label><input type="checkbox"> Elektrik (Licht/Blinker)</label>
            </div>
            <button class="btn-primary" onclick="setCheck('bike')">Check quittieren</button>
            <p id="val-check-bike" style="font-size:0.7rem; color:#888; margin-top:5px"></p>
        </div>

        <div class="card">
            <h2>üìê Fahrerische Daten</h2>
            <label>Speed: <span id="range-v">50</span> km/h</label>
            <input type="range" min="10" max="200" value="50" oninput="updateLean(this.value)">
            <div id="bike-icon" class="bike-visual">üèçÔ∏è</div>
            <p style="text-align:center"><span id="range-deg">0</span>¬∞ Neigung</p>
        </div>
    </div>

    <div id="view-car" class="view">
        <div class="card">
            <h2 id="disp-car-name">Mein Auto</h2>
            <div id="weather-info-car">Wetter-Daten identisch...</div>
        </div>
        <div class="card">
            <h2>üìù Logbuch</h2>
            <input type="number" id="log-km-c" placeholder="Distanz (km)">
            <button class="btn-primary" onclick="saveLog('car')">Fahrt speichern</button>
            <div id="list-logs-car"></div>
        </div>
        <div class="card">
            <h2>üîß Service</h2>
            <p>KM-Stand: <span id="val-km-car">0</span> / 20.000</p>
            <div class="progress-container"><div id="bar-car" class="progress-bar"></div></div>
            <button class="btn-primary" onclick="setClean('car')">W√§sche quittieren</button>
        </div>
        <div class="card">
            <h2>‚õΩ Tank-Historie</h2>
            <div id="list-tank-car"></div>
        </div>
    </div>

    <div id="view-settings" class="view">
        <div class="card">
            <h2>üé® App-Farbe</h2>
            <input type="color" id="color-ctrl" onchange="updateTheme(this.value)">
        </div>
        <div class="card">
            <h2>üèéÔ∏è Mein Fuhrpark</h2>
            <input type="text" id="set-bike-n" placeholder="Name Motorrad">
            <input type="text" id="set-car-n" placeholder="Name Auto">
            <button class="btn-primary" onclick="saveNames()">Namen speichern</button>
        </div>
        <div class="card" style="border-left-color: #f00;">
            <h2>Gefahrenzone</h2>
            <button class="btn-delete" style="width:100%; padding:15px;" onclick="resetAll()">ALLE DATEN L√ñSCHEN</button>
        </div>
    </div>
</main>

<nav class="nav">
    <button onclick="changeTab('bike')" id="nav-bike" class="nav-btn active">üèçÔ∏è</button>
    <button onclick="changeTab('car')" id="nav-car" class="nav-btn">üöó</button>
    <button onclick="changeTab('settings')" id="nav-settings" class="nav-btn">‚öôÔ∏è</button>
</nav>

<script>
    // Zentraler State
    let app = JSON.parse(localStorage.getItem('apex_fleet_data')) || {
        bike: { name: "Motorrad", km: 0, logs: [], tanks: [], clean: "-", check: "-" },
        car: { name: "Auto", km: 0, logs: [], tanks: [], clean: "-", check: "-" },
        theme: "#ff4d00"
    };

    function sync() { localStorage.setItem('apex_fleet_data', JSON.stringify(app)); refreshUI(); }

    // Navigation
    function changeTab(tab) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
        document.getElementById('nav-' + tab).classList.add('active');
        document.getElementById('view-title').innerText = tab.toUpperCase();
    }

    // Wetter (Open-Meteo)
    async function fetchWeather() {
        navigator.geolocation.getCurrentPosition(async pos => {
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`);
                const data = await res.json();
                const temp = data.current_weather.temperature;
                const info = `üìç ${temp}¬∞C | Wind: ${data.current_weather.windspeed} km/h`;
                document.getElementById('weather-info').innerText = info;
                document.getElementById('weather-info-car').innerText = info;
                document.getElementById('ride-hint').innerText = temp > 12 ? "‚úÖ Top Wetter f√ºr eine Tour!" : "‚ö†Ô∏è Ziemlich kalt, pass auf!";
            } catch(e) { console.error("Weather failed"); }
        });
    }

    // Logbuch
    function saveLog(type) {
        const kmIn = document.getElementById(type === 'bike' ? 'log-km-b' : 'log-km-c');
        const km = parseInt(kmIn.value) || 0;
        if(km === 0) return;

        const entry = {
            id: Date.now(),
            km: km,
            date: new Date().toLocaleDateString(),
            fun: document.getElementById('log-fun-b')?.value || "üöó",
            ai: km > 100 ? "KI: Krass, eine gro√üe Reise!" : "KI: Sch√∂ne Hausrunde."
        };

        app[type].logs.unshift(entry);
        app[type].km += km;
        kmIn.value = "";
        sync();
    }

    // Tanken & KI Scan
    function startAIScan(type) {
        alert("KI-Modell 'Veo-Scan' analysiert den Beleg...");
        setTimeout(() => {
            document.getElementById('tank-val-b').value = (Math.random() * 45 + 15).toFixed(2);
            document.getElementById('tank-loc-b').value = "KI: Tankstelle erkannt";
        }, 1500);
    }

    function saveTank(type) {
        const val = document.getElementById('tank-val-b').value;
        const loc = document.getElementById('tank-loc-b').value;
        if(!val) return;
        app[type].tanks.unshift({ id: Date.now(), val, loc, date: new Date().toLocaleDateString() });
        sync();
    }

    // Hilfsfunktionen
    function del(type, cat, id) { app[type][cat] = app[type][cat].filter(i => i.id !== id); sync(); }
    function manualKM(type) { const n = prompt("KM-Stand korrigieren:", app[type].km); if(n) { app[type].km = parseInt(n); sync(); } }
    function setClean(type) { app[type].clean = new Date().toLocaleDateString(); sync(); }
    function setCheck(type) { app[type].check = "Bestanden: " + new Date().toLocaleDateString(); sync(); }
    function updateTheme(c) { app.theme = c; sync(); }
    function saveNames() { 
        app.bike.name = document.getElementById('set-bike-n').value || app.bike.name;
        app.car.name = document.getElementById('set-car-n').value || app.car.name;
        sync(); 
    }
    function resetAll() { if(confirm("Wirklich alles l√∂schen?")) { localStorage.clear(); location.reload(); } }

    function updateLean(v) {
        const deg = Math.round(v / 4);
        document.getElementById('range-v').innerText = v;
        document.getElementById('range-deg').innerText = deg;
        document.getElementById('bike-icon').style.transform = `rotate(${deg}deg)`;
    }

    // UI RENDER
    function refreshUI() {
        document.documentElement.style.setProperty('--primary', app.theme);
        document.getElementById('color-ctrl').value = app.theme;

        ['bike', 'car'].forEach(t => {
            document.getElementById('disp-' + t + '-name').innerText = app[t].name;
            document.getElementById('val-km-' + t).innerText = app[t].km.toLocaleString();
            
            const limit = t === 'bike' ? 15000 : 20000;
            document.getElementById('bar-' + t).style.width = Math.min((app[t].km / limit) * 100, 100) + "%";
            
            document.getElementById('list-logs-' + t).innerHTML = app[t].logs.map(l => `
                <div class="entry">
                    <b>${l.date}</b> | ${l.km} km | ${l.fun}<br><i>${l.ai}</i>
                    <button class="btn-delete" onclick="del('${t}','logs',${l.id})">L√∂schen</button>
                </div>`).join('');

            document.getElementById('list-tank-' + t).innerHTML = app[t].tanks.map(tank => `
                <div class="entry">
                    <b>${tank.date}</b> | ${tank.val} ‚Ç¨ | ${tank.loc}
                    <button class="btn-delete" onclick="del('${t}','tanks',${tank.id})">L√∂schen</button>
                </div>`).join('');
        });
        document.getElementById('val-clean-bike').innerText = app.bike.clean;
        document.getElementById('val-check-bike').innerText = app.bike.check;
    }

    window.onload = () => { refreshUI(); fetchWeather(); };
</script>
</body>
</html>
