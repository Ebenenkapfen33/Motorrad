<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apex Fleet Hub</title>
    <style>
        :root { --accent: #ff4d00; --bg: #000; --card: #121212; --text: #fff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { padding: 15px; text-align: center; border-bottom: 2px solid var(--accent); background: #000; font-weight: bold; letter-spacing: 1px; }
        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 90px; }
        .view { display: none; }
        .view.active { display: block; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; border-left: 4px solid var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        h2 { color: var(--accent); margin: 0 0 10px 0; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        input, select { width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 8px; margin: 8px 0; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; background: var(--accent); color: white; margin-top: 5px; }
        .btn-del { background: #222; color: #ff4444; font-size: 0.75rem; padding: 6px; margin-top: 8px; border: 1px solid #444; width: auto; display: inline-block; }
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #000; padding: 15px 0; border-top: 1px solid #222; z-index: 1000; }
        .nav-btn { background: none; border: none; color: #444; flex: 1; font-size: 1.6rem; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: var(--accent); transform: scale(1.1); }
        .bar-bg { background: #222; height: 10px; border-radius: 5px; margin: 10px 0; overflow: hidden; }
        .bar-fill { background: var(--accent); height: 100%; width: 0%; transition: 0.8s ease-out; }
        .entry { background: #1a1a1a; padding: 12px; border-radius: 8px; margin-top: 10px; border: 1px solid #252525; position: relative; }
        .ki-msg { color: #888; font-style: italic; font-size: 0.8rem; margin-top: 5px; display: block; border-left: 2px solid #444; padding-left: 8px; }
    </style>
</head>
<body>

<header id="main-title">MOTORRAD</header>

<main id="app-container">
    <section id="view-bike" class="view active">
        <div class="card">
            <h2 id="name-label-bike">Mein Bike</h2>
            <div id="weather-bike">Wetter-Check lÃ¤uft...</div>
            <div id="rec-bike" style="font-weight:bold; margin-top:5px; font-size: 0.9rem;"></div>
        </div>

        <div class="card">
            <h2>ğŸ“ Logbuch</h2>
            <input type="number" id="log-km-bike" placeholder="Kilometer">
            <input type="number" id="log-min-bike" placeholder="Zeit (Min)">
            <select id="log-fun-bike">
                <option value="10">ğŸ”¥ Adrenalin Pur</option>
                <option value="5">ğŸ˜ Ganz okay</option>
                <option value="1">ğŸ’¤ Langweilig</option>
            </select>
            <button onclick="addLog('bike')">Eintrag speichern</button>
            <div id="logs-bike"></div>
        </div>

        <div class="card">
            <h2>ğŸ”§ Service & Pflege</h2>
            <p>Stand: <span id="km-bike">0</span> / 15.000 km</p>
            <div class="bar-bg"><div id="bar-bike" class="bar-fill"></div></div>
            <button style="background:#222; border:1px solid #444" onclick="adjustKM('bike')">KM manuell korrigieren</button>
            <div style="margin-top:15px; font-size:0.85rem">
                Pflege (Kette/WÃ¤sche): <span id="clean-bike">-</span>
            </div>
            <button onclick="markClean('bike')">Heute gewaschen & Kette gefettet</button>
        </div>

        <div class="card">
            <h2>â›½ Tanken (KI-Scan)</h2>
            <input type="file" accept="image/*" onchange="runAIScan('bike')">
            <input type="number" id="tank-p-bike" placeholder="Betrag in â‚¬">
            <input type="text" id="tank-l-bike" placeholder="Ort/Station">
            <button onclick="addTank('bike')">Manuell speichern</button>
            <div id="tanks-bike"></div>
        </div>

        <div class="card">
            <h2>ğŸ›¡ï¸ AusrÃ¼stungs-Check</h2>
            <div id="checks-bike">
                <label><input type="checkbox"> Helm (Zustand/Visier)</label><br>
                <label><input type="checkbox"> Kettenspannung</label><br>
                <label><input type="checkbox"> Reifendruck</label><br>
                <label><input type="checkbox"> Elektrik (Licht/Blinker)</label>
            </div>
            <button onclick="signCheck('bike')">Check quittieren</button>
            <div id="check-res-bike" style="font-size:0.75rem; color:#888; margin-top:8px"></div>
        </div>

        <div class="card">
            <h2>ğŸ“ Fahrerische Daten</h2>
            <input type="range" min="0" max="180" value="0" oninput="leanCalc(this.value)">
            <div id="lean-icon" style="font-size:60px; text-align:center; margin:15px; transition:0.1s">ğŸï¸</div>
            <p style="text-align:center; font-weight:bold"><span id="lean-deg">0</span>Â° Neigung</p>
        </div>
    </section>

    <section id="view-car" class="view">
        <div class="card">
            <h2 id="name-label-car">Mein Auto</h2>
            <div id="weather-car">Wetter wie Bike...</div>
        </div>
        <div class="card">
            <h2>ğŸ“ Logbuch</h2>
            <input type="number" id="log-km-car" placeholder="Kilometer">
            <button onclick="addLog('car')">Fahrt speichern</button>
            <div id="logs-car"></div>
        </div>
        <div class="card">
            <h2>ğŸ”§ Service</h2>
            <p>Stand: <span id="km-car">0</span> / 20.000 km</p>
            <div class="bar-bg"><div id="bar-car" class="bar-fill"></div></div>
            <button onclick="markClean('car')">WÃ¤sche quittieren</button>
        </div>
        <div class="card">
            <h2>â›½ Tanken</h2>
            <div id="tanks-car"></div>
        </div>
    </section>

    <section id="view-set" class="view">
        <div class="card">
            <h2>ğŸ¨ Farbeinstellungen</h2>
            <input type="color" id="color-pick" onchange="updateColor(this.value)">
        </div>
        <div class="card">
            <h2>ğŸï¸ Fuhrpark Management</h2>
            <input type="text" id="in-bike-name" placeholder="Name Motorrad">
            <input type="text" id="in-car-name" placeholder="Name Auto">
            <button onclick="saveFleet()">Namen speichern</button>
        </div>
        <button class="btn-del" style="width:100%; padding:15px; background:#f00; color:#fff" onclick="clearData()">ALLE DATEN LÃ–SCHEN</button>
    </section>
</main>

<nav class="nav">
    <button onclick="showTab('bike')" id="nav-bike" class="nav-btn active">ğŸï¸</button>
    <button onclick="showTab('car')" id="nav-car" class="nav-btn">ğŸš—</button>
    <button onclick="showTab('set')" id="nav-set" class="nav-btn">âš™ï¸</button>
</nav>

<script>
    // Robustes Daten-Management
    let db = JSON.parse(localStorage.getItem('apex_fleet_v1')) || {
        bike: { name: "Motorrad", km: 0, logs: [], tanks: [], clean: "-", check: "-" },
        car: { name: "Auto", km: 0, logs: [], tanks: [], clean: "-", check: "-" },
        ui: { color: "#ff4d00" }
    };

    function sync() { 
        localStorage.setItem('apex_fleet_v1', JSON.stringify(db)); 
        render(); 
    }

    // Tab-Steuerung
    function showTab(tab) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
        document.getElementById('nav-' + tab).classList.add('active');
        document.getElementById('main-title').innerText = tab.toUpperCase();
    }

    // Wetter & Empfehlung
    async function initWeather() {
        navigator.geolocation.getCurrentPosition(async (pos) => {
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`);
                const data = await res.json();
                const t = data.current_weather.temperature;
                const info = `ğŸŒ¡ï¸ ${t}Â°C | ğŸ’¨ ${data.current_weather.windspeed} km/h`;
                document.getElementById('weather-bike').innerText = info;
                document.getElementById('weather-car').innerText = info;
                document.getElementById('rec-bike').innerText = t > 12 ? "âœ… Beste Bedingungen!" : "âš ï¸ Heute lieber vorsichtig.";
            } catch (e) { document.getElementById('weather-bike').innerText = "Wetter-Service offline"; }
        });
    }

    // Logbuch mit KI-Kommentar
    function addLog(type) {
        const kmIn = document.getElementById('log-km-' + type);
        const km = parseInt(kmIn.value) || 0;
        const fun = document.getElementById('log-fun-bike')?.value || 5;
        
        let aiMsg = "KI: Gute Fahrt!";
        if(km > 100) aiMsg = "KI: Respekt, das war eine ordentliche Tour!";
        if(fun > 8) aiMsg = "KI: Man merkt den SpaÃŸ am Gasgriff!";
        if(km < 10) aiMsg = "KI: Nur mal kurz um den Block?";

        db[type].logs.unshift({ id: Date.now(), km, date: new Date().toLocaleDateString(), fun, aiMsg });
        db[type].km += km;
        kmIn.value = "";
        sync();
    }

    // KI Tank Scan Simulation
    function runAIScan(type) {
        alert("KI-Modell 'Gemini-Flash' liest Beleg aus...");
        setTimeout(() => {
            document.getElementById('tank-p-' + type).value = (Math.random() * 35 + 15).toFixed(2);
            document.getElementById('tank-l-' + type).value = "KI: Shell Station";
        }, 1500);
    }

    function addTank(type) {
        const p = document.getElementById('tank-p-' + type).value;
        const l = document.getElementById('tank-l-' + type).value;
        if(p) {
            db[type].tanks.unshift({ id: Date.now(), p, l, date: new Date().toLocaleDateString() });
            sync();
        }
    }

    // LÃ¶schen
    function removeItem(type, cat, id) {
        db[type][cat] = db[type][cat].filter(i => i.id !== id);
        sync();
    }

    function adjustKM(type) {
        const val = prompt("KM-Stand manuell anpassen:", db[type].km);
        if(val !== null) { db[type].km = parseInt(val); sync(); }
    }

    function markClean(type) { db[type].clean = new Date().toLocaleDateString(); sync(); }
    function signCheck(type) { db[type].check = "Bestanden: " + new Date().toLocaleDateString(); sync(); }
    function updateColor(c) { db.ui.color = c; sync(); }
    function clearData() { if(confirm("Wirklich alles lÃ¶schen?")) { localStorage.clear(); location.reload(); } }
    
    function saveFleet() {
        db.bike.name = document.getElementById('in-bike-name').value || db.bike.name;
        db.car.name = document.getElementById('in-car-name').value || db.car.name;
        sync();
    }

    function leanCalc(v) {
        const d = Math.round(v / 3.8);
        document.getElementById('lean-icon').style.transform = `rotate(${d}deg)`;
        document.getElementById('lean-deg').innerText = d;
    }

    // UI RENDERING
    function render() {
        document.documentElement.style.setProperty('--accent', db.ui.color);
        document.getElementById('color-pick').value = db.ui.color;

        ['bike', 'car'].forEach(t => {
            document.getElementById('name-label-' + t).innerText = db[t].name;
            document.getElementById('km-' + t).innerText = db[t].km.toLocaleString();
            const limit = t === 'bike' ? 15000 : 20000;
            document.getElementById('bar-' + t).style.width = Math.min((db[t].km / limit) * 100, 100) + "%";
            
            // Render Logs
            document.getElementById('logs-' + t).innerHTML = db[t].logs.map(l => `
                <div class="entry">
                    <b>${l.date}</b> | ${l.km} km<br>
                    <span class="ki-msg">${l.aiMsg}</span>
                    <button class="btn-del" onclick="removeItem('${t}','logs',${l.id})">LÃ¶schen</button>
                </div>
            `).join('');

            // Render Tank
            document.getElementById('tanks-' + t).innerHTML = db[t].tanks.map(tank => `
                <div class="entry">
                    <b>${tank.date}</b>: ${tank.p} â‚¬ | ${tank.l}
                    <button class="btn-del" onclick="removeItem('${t}','tanks',${tank.id})">LÃ¶schen</button>
                </div>
            `).join('');
        });
        document.getElementById('clean-bike').innerText = db.bike.clean;
        document.getElementById('check-res-bike').innerText = db.bike.check;
    }

    window.onload = () => { render(); initWeather(); };
</script>
</body>
</html>

