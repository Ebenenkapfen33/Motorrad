<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Fix</title>
    <style>
        :root { --accent: #ff4d00; --bg: #000; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; padding: 15px; }
        .card { background: #121212; border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--accent); }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 5px; font-size: 16px; }
        button { width: 100%; padding: 15px; background: var(--accent); color: #fff; border: none; border-radius: 8px; font-weight: bold; }
        .nav { position: fixed; bottom: 0; left: 0; width: 100%; display: flex; background: #000; border-top: 1px solid #333; height: 60px; }
        .nav-item { flex: 1; display: flex; align-items: center; justify-content: center; color: #666; }
        .nav-item.active { color: var(--accent); }
        .entry { background: #1a1a1a; padding: 10px; margin-top: 10px; border-radius: 5px; border: 1px solid #333; }
        .view { display: none; padding-bottom: 80px; }
        .view.active { display: block; }
    </style>
</head>
<body>

<h2 id="title">MOTORRAD</h2>

<main>
    <div id="v-bike" class="view active">
        <div class="card">
            <h3>KM-Logbuch</h3>
            <input type="number" id="km-bike" placeholder="Gefahrene KM...">
            <button onclick="doSave('bike')">SPEICHERN</button>
            <div id="list-bike"></div>
        </div>
        <div class="card">
            <h3>Tanken</h3>
            <input type="number" step="0.01" id="p-bike" placeholder="Preis (z.B. 14.92)">
            <button onclick="doTank('bike')">TANKEN SPEICHERN</button>
            <div id="t-list-bike"></div>
        </div>
    </div>

    <div id="v-car" class="view">
        <div class="card">
            <h3>KM-Logbuch</h3>
            <input type="number" id="km-car" placeholder="Gefahrene KM...">
            <button onclick="doSave('car')">SPEICHERN</button>
            <div id="list-car"></div>
        </div>
        <div class="card">
            <h3>Tanken</h3>
            <input type="number" step="0.01" id="p-car" placeholder="Preis (z.B. 14.92)">
            <button onclick="doTank('car')">TANKEN SPEICHERN</button>
            <div id="t-list-car"></div>
        </div>
    </div>
</main>

<div class="nav">
    <div class="nav-item active" onclick="tab('bike', this)">BIKE</div>
    <div class="nav-item" onclick="tab('car', this)">CAR</div>
    <div onclick="localStorage.clear(); location.reload();" class="nav-item" style="color: red;">RESET</div>
</div>

<script>
    // INITIALISIERUNG - Wir nutzen einen komplett neuen Key
    const KEY = 'APEX_FINAL_DATA_RESCUE';
    let data = JSON.parse(localStorage.getItem(KEY)) || {
        bike: { logs: [], tanks: [] },
        car: { logs: [], tanks: [] }
    };

    function tab(v, el) {
        document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        document.getElementById('v-'+v).classList.add('active');
        el.classList.add('active');
        document.getElementById('title').innerText = v.toUpperCase();
    }

    function doSave(t) {
        const val = document.getElementById('km-'+t).value;
        if(!val) return;
        data[t].logs.unshift({ km: val, d: new Date().toLocaleDateString() });
        commit();
        document.getElementById('km-'+t).value = "";
    }

    function doTank(t) {
        const val = document.getElementById('p-'+t).value;
        if(!val) return;
        data[t].tanks.unshift({ p: val, d: new Date().toLocaleDateString() });
        commit();
        document.getElementById('p-'+t).value = "";
    }

    function commit() {
        try {
            localStorage.setItem(KEY, JSON.stringify(data));
            console.log("Gespeichert!");
            render();
        } catch(e) {
            alert("FEHLER BEIM SPEICHERN: " + e);
        }
    }

    function render() {
        ['bike', 'car'].forEach(t => {
            document.getElementById('list-'+t).innerHTML = data[t].logs.map(l => `<div class="entry">${l.d}: ${l.km} km</div>`).join('');
            document.getElementById('t-list-'+t).innerHTML = data[t].tanks.map(tank => `<div class="entry">${tank.d}: ${tank.p} â‚¬</div>`).join('');
        });
    }

    render();
</script>
</body>
</html>
