<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Fleet Suite</title>
    <style>
        :root { --main-color: #ff4d00; --bg: #0a0a0a; --card: #161616; --text: #eee; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Header & Navigation */
        header { padding: 15px; text-align: center; border-bottom: 2px solid var(--main-color); background: #000; }
        .tab-bar { position: fixed; bottom: 0; width: 100%; display: flex; background: #000; padding: 10px 0; border-top: 1px solid #333; z-index: 100; }
        .tab-bar button { background: none; border: none; color: #888; flex: 1; font-size: 1.2rem; cursor: pointer; }
        .tab-bar button.active { color: var(--main-color); }

        /* Layout */
        main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .view { display: none; }
        .view.active { display: block; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 4px solid var(--main-color); }
        
        /* Formulare */
        h2 { color: var(--main-color); margin-top: 0; font-size: 1.1rem; }
        input, select, textarea { width: 100%; padding: 10px; background: #222; border: 1px solid #333; color: #fff; border-radius: 6px; margin: 5px 0 10px 0; box-sizing: border-box; }
        button.action-btn { background: var(--main-color); color: white; border: none; padding: 10px; border-radius: 6px; width: 100%; font-weight: bold; cursor: pointer; }
        button.delete-btn { background: #444; color: #ff4444; border: none; padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; margin-top: 5px; cursor: pointer; }

        /* Spezifische Elemente */
        .progress-bg { background: #333; height: 10px; border-radius: 5px; margin: 10px 0; }
        .progress-fill { background: var(--main-color); height: 100%; border-radius: 5px; width: 0%; transition: 0.5s; }
        .history-item { background: #222; padding: 10px; border-radius: 6px; margin-top: 10px; font-size: 0.9rem; position: relative; }
        .bike-anim { font-size: 40px; text-align: center; margin: 20px 0; transition: 0.3s; }
    </style>
</head>
<body>

<header><h1 id="app-title">Motorrad</h1></header>

<main id="content">
    <section id="view-bike" class="view active">
        <div class="card">
            <h2 id="bike-name-display">Mein Motorrad</h2>
            <div id="weather-box">Wetter wird geladen...</div>
            <p id="ride-recommendation" style="font-weight:bold"></p>
        </div>

        <div class="card">
            <h2>üìù Logbuch</h2>
            <input type="number" id="log-km" placeholder="Gefahrene km">
            <input type="number" id="log-time" placeholder="Zeit (Minuten)">
            <select id="log-fun"><option value="1">Lame</option><option value="5">Mittel</option><option value="10">Adrenalin pur!</option></select>
            <button class="action-btn" onclick="addLog('bike')">Fahrt speichern</button>
            <div id="log-history-bike"></div>
        </div>

        <div class="card">
            <h2>üîß Service</h2>
            <label>Aktueller km-Stand:</label>
            <input type="number" id="serv-km-bike" onchange="updateService('bike')">
            <div class="progress-bg"><div id="serv-bar-bike" class="progress-fill"></div></div>
            <p id="serv-text-bike">Service f√§llig bei 15.000 km</p>
            <hr>
            <p>Letzte Reinigung (Kette/W√§sche): <span id="clean-date-bike">-</span></p>
            <button class="action-btn" style="background:#444" onclick="setCleanDate('bike')">Jetzt gereinigt & gewaschen</button>
        </div>

        <div class="card">
            <h2>‚õΩ Tanken</h2>
            <input type="file" id="receipt-bike" accept="image/*" onchange="simulateAI('bike')">
            <p><small>(KI-Simulation: Foto hochladen oder manuell eintragen)</small></p>
            <input type="number" id="tank-price" placeholder="Preis (‚Ç¨)">
            <input type="text" id="tank-loc" placeholder="Ort/Tankstelle">
            <button class="action-btn" onclick="addTank('bike')">Manuell speichern</button>
            <div id="tank-history-bike"></div>
        </div>

        <div class="card">
            <h2>üõ°Ô∏è Ausr√ºstungs-Check</h2>
            <div id="check-list-bike">
                <label><input type="checkbox"> Helm okay/Alter?</label><br>
                <label><input type="checkbox"> Kombi intakt?</label><br>
                <label><input type="checkbox"> Kette Spannung/Fett?</label><br>
                <label><input type="checkbox"> Luftdruck okay?</label><br>
                <label><input type="checkbox"> Elektrik Check?</label>
            </div>
            <p id="check-date-bike"></p>
            <button class="action-btn" onclick="quittieren('bike')">Quittieren & Speichern</button>
            <button class="delete-btn" onclick="resetCheck('bike')">Check l√∂schen</button>
        </div>

        <div class="card">
            <h2>üìê Fahrerische Daten</h2>
            <label>Speed: <span id="v-val">50</span> km/h</label>
            <input type="range" min="20" max="200" value="50" oninput="calcLean(this.value)">
            <div class="bike-anim" id="bike-icon">üèçÔ∏è</div>
        </div>
    </section>

    <section id="view-car" class="view">
        <div class="card">
            <h2 id="car-name-display">Mein Auto</h2>
            <div id="weather-box-car">Wetter-Daten identisch...</div>
        </div>
        <div class="card"><h2>üìù Logbuch</h2><input type="number" id="log-km-car"><button class="action-btn" onclick="addLog('car')">Speichern</button><div id="log-history-car"></div></div>
        <div class="card"><h2>üîß Service</h2><input type="number" id="serv-km-car" onchange="updateService('car')"><div class="progress-bg"><div id="serv-bar-car" class="progress-fill"></div></div><p id="serv-text-car"></p></div>
    </section>

    <section id="view-settings" class="view">
        <div class="card">
            <h2>üé® Design</h2>
            <label>App-Farbe w√§hlen:</label>
            <input type="color" id="color-picker" value="#ff4d00" onchange="changeTheme(this.value)">
        </div>
        <div class="card">
            <h2>üèéÔ∏è Fuhrpark</h2>
            <input type="text" id="set-bike-name" placeholder="Name Motorrad (z.B. BMW S1000RR)">
            <input type="text" id="set-car-name" placeholder="Name Auto (z.B. Audi RS6)">
            <button class="action-btn" onclick="saveFleet()">Fuhrpark speichern</button>
        </div>
    </section>
</main>

<nav class="tab-bar">
    <button onclick="switchTab('bike', this)" class="active">üèçÔ∏è</button>
    <button onclick="switchTab('car', this)">üöó</button>
    <button onclick="switchTab('settings', this)">‚öôÔ∏è</button>
</nav>

<script>
    // Datenstruktur Initialisierung
    let db = JSON.parse(localStorage.getItem('apex_db')) || {
        bike: { name: "Motorrad", logs: [], tank: [], km: 0, clean: "-", check: "-" },
        car: { name: "Auto", logs: [], tank: [], km: 0, clean: "-", check: "-" },
        theme: "#ff4d00"
    };

    function saveDB() { localStorage.setItem('apex_db', JSON.stringify(db)); }

    // Tab Wechsel
    function switchTab(type, btn) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
        document.getElementById('view-' + type).classList.add('active');
        btn.classList.add('active');
        document.getElementById('app-title').innerText = type === 'bike' ? 'Motorrad' : (type === 'car' ? 'Auto' : 'Einstellungen');
    }

    // Wetter & KI Empfehlung
    async function updateWeather() {
        navigator.geolocation.getCurrentPosition(async p => {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.coords.latitude}&longitude=${p.coords.longitude}&current_weather=true&hourly=rain`);
            const data = await res.json();
            const temp = data.current_weather.temperature;
            const wind = data.current_weather.windspeed;
            const isRain = data.current_weather.weathercode > 50;

            const box = document.getElementById('weather-box');
            box.innerHTML = `üå°Ô∏è ${temp}¬∞C | üí® ${wind}km/h | ${isRain ? 'üåßÔ∏è Regen' : '‚òÄÔ∏è Trocken'}`;
            
            const rec = document.getElementById('ride-recommendation');
            if(temp > 12 && !isRain) { rec.innerText = "‚úÖ Empfehlung: Ab auf die Stra√üe!"; rec.style.color = "var(--main-color)"; }
            else if(temp > 5 && !isRain) { rec.innerText = "‚ö†Ô∏è Kurze Runde okay, pass auf!"; rec.style.color = "yellow"; }
            else { rec.innerText = "‚ùå Heute lieber nicht fahren."; rec.style.color = "red"; }
        });
    }

    // Logbuch
    function addLog(type) {
        const km = parseInt(document.getElementById('log-km' + (type==='car'?'-car':'')).value);
        const fun = document.getElementById('log-fun')?.value || 5;
        const kiComment = fun > 8 ? "KI: Wahnsinn! Das war Adrenalin pur." : "KI: Entspannte Tour, gut f√ºr den Motor.";
        
        const entry = { id: Date.now(), km, fun, kiComment, date: new Date().toLocaleDateString() };
        db[type].logs.push(entry);
        db[type].km += km; // Auto-Add to KM
        saveDB();
        renderLogs(type);
        updateService(type);
    }

    function renderLogs(type) {
        const container = document.getElementById('log-history-' + type);
        container.innerHTML = db[type].logs.map(l => `
            <div class="history-item">
                <b>${l.date}</b>: ${l.km}km | Spa√ü: ${l.fun}/10 km<br><i>${l.kiComment}</i>
                <br><button class="delete-btn" onclick="deleteItem('${type}', 'logs', ${l.id})">L√∂schen</button>
            </div>
        `).join('');
    }

    // Service
    function updateService(type) {
        const current = db[type].km;
        const target = 15000; // Beispiel Intervall
        const perc = Math.min((current / target) * 100, 100);
        document.getElementById('serv-bar-' + type).style.width = perc + "%";
        document.getElementById('serv-text-' + type).innerText = `Service f√§llig bei ${target} km (Status: ${current} km)`;
        document.getElementById('serv-km-' + type).value = current;
    }

    function setCleanDate(type) {
        db[type].clean = new Date().toLocaleDateString();
        saveDB();
        document.getElementById('clean-date-' + type).innerText = db[type].clean;
    }

    // KI Tank-Simulation
    function simulateAI(type) {
        setTimeout(() => {
            const price = (Math.random() * 50 + 40).toFixed(2);
            document.getElementById('tank-price').value = price;
            document.getElementById('tank-loc').value = "KI-Scan: Shell Station";
            alert("KI hat den Beleg gescannt: " + price + "‚Ç¨ erkannt.");
        }, 1000);
    }

    function addTank(type) {
        const p = document.getElementById('tank-price').value;
        const l = document.getElementById('tank-loc').value;
        db[type].tank.push({ id: Date.now(), p, l, date: new Date().toLocaleDateString() });
        saveDB();
        renderTank(type);
    }

    function renderTank(type) {
        const container = document.getElementById('tank-history-' + type);
        container.innerHTML = db[type].tank.map(t => `
            <div class="history-item">${t.date}: ${t.p}‚Ç¨ @ ${t.l} 
            <button class="delete-btn" onclick="deleteItem('${type}', 'tank', ${t.id})">L√∂schen</button></div>
        `).join('');
    }

    // Checkliste
    function quittieren(type) {
        db[type].check = "Zuletzt gepr√ºft: " + new Date().toLocaleDateString();
        saveDB();
        document.getElementById('check-date-' + type).innerText = db[type].check;
    }

    function resetCheck(type) {
        db[type].check = "-";
        saveDB();
        document.getElementById('check-date-' + type).innerText = "-";
        document.querySelectorAll(`#check-list-${type} input`).forEach(i => i.checked = false);
    }

    // Physik
    function calcLean(v) {
        document.getElementById('v-val').innerText = v;
        const angle = Math.min(v / 4, 55);
        document.getElementById('bike-icon').style.transform = `rotate(${angle}deg)`;
        document.getElementById('lean-val').innerText = Math.round(angle);
    }

    // Einstellungen & Theme
    function changeTheme(color) {
        document.documentElement.style.setProperty('--main-color', color);
        db.theme = color;
        saveDB();
    }

    function saveFleet() {
        db.bike.name = document.getElementById('set-bike-name').value;
        db.car.name = document.getElementById('set-car-name').value;
        saveDB();
        location.reload();
    }

    function deleteItem(type, category, id) {
        db[type][category] = db[type][category].filter(i => i.id !== id);
        saveDB();
        location.reload();
    }

    // Init
    window.onload = () => {
        changeTheme(db.theme);
        document.getElementById('bike-name-display').innerText = db.bike.name;
        document.getElementById('car-name-display').innerText = db.car.name;
        document.getElementById('clean-date-bike').innerText = db.bike.clean;
        document.getElementById('check-date-bike').innerText = db.bike.check;
        updateWeather();
        renderLogs('bike'); renderLogs('car');
        renderTank('bike');
        updateService('bike'); updateService('car');
    };
</script>
</body>
</html>
